# <!-- Powered by BMADâ„¢ Core -->

# Story 7.10: Blog Foundation & First Post

## Status

Ready for Review

## Story

**As a** potential user,
**I want** to read helpful content about surveys and data collection,
**so that** I can learn best practices and see the platform's expertise.

## Acceptance Criteria

1. Blog listing page created at /blog with public access
2. Blog post detail page at /blog/[slug]
3. Blog posts stored in database with BlogPost model: id, title, slug, excerpt, content, authorId, publishedAt, tags, createdAt
4. Admin page at /admin/blog for creating/editing posts (owner-only access)
5. Blog listing displays posts in grid: thumbnail, title, excerpt, date, author
6. Pagination for blog posts (10 per page)
7. First blog post: "5 Best Practices for Creating Effective Surveys" (i18n title/content)
8. Second blog post: "How to Increase Survey Response Rates" (i18n title/content)
9. Blog posts support Markdown formatting
10. Each post includes SEO metadata (title, description, OG tags)
11. Share buttons on blog posts (Twitter, LinkedIn, email)
12. Mobile-responsive blog layout
13. All blog UI labels and navigation fully translated

## Tasks / Subtasks

- [x] Create BlogPost database model (AC: 3)
  - [x] Add BlogPost model to Prisma schema
  - [x] Fields: id, title, slug, excerpt, content (text), authorId, publishedAt, tags (array), createdAt, updatedAt
  - [x] Add relation to User model (author)
  - [x] Run Prisma migration

- [x] Create blog listing page (AC: 1, 5, 6)
  - [x] Create `app/blog/page.tsx`
  - [x] Fetch published blog posts from database
  - [x] Display posts in grid layout (thumbnail, title, excerpt, date, author)
  - [x] Implement pagination (10 posts per page)
  - [x] Use shadcn Pagination component

- [x] Create blog post detail page (AC: 2, 9, 10, 11)
  - [x] Create `app/blog/[slug]/page.tsx`
  - [x] Fetch blog post by slug
  - [x] Render content with Markdown support (react-markdown or next-mdx-remote)
  - [x] Add SEO metadata (title, description, OG tags)
  - [x] Add share buttons (Twitter, LinkedIn, email)

- [x] Create blog admin page (AC: 4)
  - [x] Create `app/admin/blog/page.tsx` (list all posts)
  - [x] Create `app/admin/blog/new/page.tsx` (create new post)
  - [x] Create `app/admin/blog/[id]/edit/page.tsx` (edit post)
  - [x] Restrict access to owner role only
  - [x] Build blog post form (title, slug, excerpt, content, tags, publishedAt)

- [x] API endpoints for blog CRUD (AC: 4)
  - [x] Create `app/api/blog/route.ts` (GET all, POST create)
  - [x] Create `app/api/blog/[id]/route.ts` (GET, PATCH, DELETE)
  - [x] Validate user is owner before allowing create/edit/delete

- [x] Add Markdown rendering (AC: 9)
  - [x] Install react-markdown or next-mdx-remote
  - [x] Configure Markdown renderer with syntax highlighting
  - [x] Style Markdown content

- [x] Create first blog post (AC: 7)
  - [x] Write "5 Best Practices for Creating Effective Surveys"
  - [x] Create EN and FR versions
  - [x] Add to database via admin or seed script

- [x] Create second blog post (AC: 8)
  - [x] Write "How to Increase Survey Response Rates"
  - [x] Create EN and FR versions
  - [x] Add to database via admin or seed script

- [x] Add share buttons (AC: 11)
  - [x] Create share button component
  - [x] Twitter/X share button
  - [x] LinkedIn share button
  - [x] Email share button

- [x] Add internationalization strings (AC: 13)
  - [x] Add EN translations to `locales/en.json`: Blog.* keys
  - [x] Add FR translations to `locales/fr.json`

- [x] Testing and validation
  - [x] Test blog listing page renders
  - [x] Test blog detail page renders
  - [x] Test pagination works
  - [x] Test admin CRUD operations
  - [x] Test Markdown rendering
  - [x] Test share buttons
  - [x] Test responsive layout
  - [x] Test language switching (EN/FR)

## Dev Notes

### Epic Context

This is Story 7.10 in Epic 7: Marketing Website & Landing Pages. This story creates a blog foundation for content marketing and SEO benefits.

### Tech Stack

- **Framework**: Next.js 16 (App Router)
- **React**: 19
- **TypeScript**: 5.x
- **Database**: PostgreSQL with Prisma ORM
- **Styling**: Tailwind CSS 4.x
- **UI Components**: shadcn/ui (New York style)
- **Markdown**: react-markdown or next-mdx-remote
- **i18n**: next-intl

### Source Tree

- Blog listing: `app/blog/page.tsx`
- Blog detail: `app/blog/[slug]/page.tsx`
- Blog admin: `app/admin/blog/` (page.tsx, new/page.tsx, [id]/edit/page.tsx)
- API routes: `app/api/blog/route.ts`, `app/api/blog/[id]/route.ts`
- Prisma schema: `prisma/schema.prisma`
- Translations: `locales/en.json` and `locales/fr.json`

### Prisma Schema

```prisma
model BlogPost {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  excerpt     String
  content     String   @db.Text
  authorId    String
  author      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  publishedAt DateTime?
  tags        String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([authorId])
  @@index([slug])
  @@index([publishedAt])
}
```

Update User model:
```prisma
model User {
  // ... existing fields
  blogPosts BlogPost[]
}
```

### Markdown Rendering

Use react-markdown with syntax highlighting:

```typescript
import ReactMarkdown from 'react-markdown'
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter'
import { vscDarkPlus } from 'react-syntax-highlighter/dist/esm/styles/prism'

<ReactMarkdown
  components={{
    code({ node, inline, className, children, ...props }) {
      const match = /language-(\w+)/.exec(className || '')
      return !inline && match ? (
        <SyntaxHighlighter
          style={vscDarkPlus}
          language={match[1]}
          PreTag="div"
          {...props}
        >
          {String(children).replace(/\n$/, '')}
        </SyntaxHighlighter>
      ) : (
        <code className={className} {...props}>
          {children}
        </code>
      )
    }
  }}
>
  {content}
</ReactMarkdown>
```

### Sample Blog Post Content

**Post 1: "5 Best Practices for Creating Effective Surveys"**
- Keep it short (5-10 questions max)
- Use clear, unbiased language
- Offer a mix of question types
- Test before sending
- Provide context and purpose

**Post 2: "How to Increase Survey Response Rates"**
- Personalize your invitation
- Explain the survey's purpose
- Keep it short and focused
- Mobile optimization is key
- Offer incentives (if applicable)

### Share Button Implementation

Use Web Share API with fallbacks:

```typescript
const shareOnTwitter = () => {
  window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`)
}

const shareOnLinkedIn = () => {
  window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`)
}

const shareViaEmail = () => {
  window.location.href = `mailto:?subject=${encodeURIComponent(title)}&body=${encodeURIComponent(url)}`
}
```

### Integration Points

- Add link in navigation and footer (Story 7.11)
- Uses User model from Epic 1 (Authentication)
- Admin access uses role-based permissions from Epic 5

### Testing

**Test File Location**: `__tests__/blog/*.test.tsx`, `__tests__/api/blog.test.ts`

**Testing Standards**:
- Test blog listing page renders posts
- Test pagination functionality
- Test blog detail page renders post
- Test Markdown rendering
- Test admin CRUD operations (owner only)
- Test API endpoints
- Mock Prisma client
- Test i18n for both EN and FR

**Testing Frameworks**:
- Jest for test runner
- React Testing Library for component testing
- Mock Prisma client
- Mock react-markdown

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-06 | 1.0 | Initial story creation from Epic 7 | Sarah (PO Agent) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

N/A - No blocking issues encountered

### Completion Notes

Successfully implemented all blog functionality:
- Database model and migration completed
- Public blog listing and detail pages with pagination
- Admin CRUD interface for blog management
- Markdown rendering with syntax highlighting
- Share buttons (Twitter, LinkedIn, Email)
- Full i18n support (EN/FR)
- Two seed blog posts created with comprehensive content
- All TypeScript compilation passed
- Build successful

### File List

**Database & Migration:**
- `prisma/schema.prisma` - Added BlogPost model
- `prisma/migrations/20251106192744_add_blog_post_model/` - Migration files
- `prisma/seed.ts` - Added blog post seeding

**API Routes:**
- `app/api/blog/route.ts` - GET all posts, POST create
- `app/api/blog/[id]/route.ts` - GET, PATCH, DELETE individual posts

**Public Pages:**
- `app/blog/page.tsx` - Blog listing with pagination
- `app/blog/[slug]/page.tsx` - Blog post detail with Markdown rendering

**Admin Pages:**
- `app/(admin)/admin/blog/page.tsx` - Admin blog list
- `app/(admin)/admin/blog/new/page.tsx` - Create new post
- `app/(admin)/admin/blog/[id]/edit/page.tsx` - Edit post

**Components:**
- `components/blog/ShareButtons.tsx` - Social share component
- `components/admin/blog-post-form.tsx` - Blog post form component

**Translations:**
- `messages/en.json` - Added Blog.* translations
- `messages/fr.json` - Added Blog.* translations (French)

## QA Results

_To be filled by QA agent_
