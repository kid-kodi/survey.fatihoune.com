# <!-- Powered by BMADâ„¢ Core -->

# Story 7.16: Multi-language Support & Locale Switching

## Status

Draft

## Story

**As a** user,
**I want** to view the website in my preferred language (English or French),
**so that** I can understand content in my native language.

## Acceptance Criteria

1. next-intl or next-i18next integrated for internationalization
2. Language selector in footer and navigation bar
3. All marketing pages support EN and FR locales
4. URL structure: /en/pricing and /fr/pricing (or domain-based)
5. Language preference stored in cookie or localStorage
6. Language auto-detected from browser Accept-Language header
7. Language switcher preserves current page (e.g., /en/about â†’ /fr/about)
8. All UI strings externalized to en.json and fr.json
9. SEO optimized with hreflang tags for language variants
10. Date and number formatting localized (e.g., 1,234.56 vs 1 234,56)
11. Currency displayed correctly (USD for EN, EUR for FR if applicable)
12. Professional translation review for all FR content
13. Language toggle includes flag icons and language names

## Acceptance Criteria (Continued)

Note: Based on the existing project setup (Epic 6 implemented i18n), this story may involve enhancing the existing next-intl configuration for marketing pages.

## Tasks / Subtasks

- [ ] Verify/Install next-intl (AC: 1)
  - [ ] Check if next-intl is already installed (from Epic 6)
  - [ ] If not installed, install `next-intl` package
  - [ ] Configure next-intl in `next.config.js`
  - [ ] Set up middleware for locale detection

- [ ] Configure i18n routing (AC: 4)
  - [ ] Set up URL structure: /en/* and /fr/*
  - [ ] Configure middleware to handle locale routing
  - [ ] Set default locale (en)
  - [ ] Support locale prefix (always or as-needed)

- [ ] Create language selector component (AC: 2, 13)
  - [ ] Create `components/layout/language-selector.tsx`
  - [ ] Add language toggle with EN/FR options
  - [ ] Display flag icons (ðŸ‡¬ðŸ‡§ ðŸ‡«ðŸ‡· or use flag icon library)
  - [ ] Display language names ("English", "FranÃ§ais")
  - [ ] Add to footer (Story 7.11)
  - [ ] Add to navigation bar (Story 7.11)

- [ ] Implement locale switching (AC: 5, 7)
  - [ ] Store language preference in cookie
  - [ ] Use next-intl's `useRouter` for locale switching
  - [ ] Preserve current page when switching languages
  - [ ] Example: /en/about â†’ /fr/about

- [ ] Auto-detect browser language (AC: 6)
  - [ ] Configure middleware to read Accept-Language header
  - [ ] Redirect to user's preferred language on first visit
  - [ ] Respect stored cookie preference over auto-detection

- [ ] Externalize all UI strings (AC: 8)
  - [ ] Create `locales/en.json` with all EN strings
  - [ ] Create `locales/fr.json` with all FR strings
  - [ ] Ensure all marketing pages use i18n keys
  - [ ] Replace hardcoded strings with translation keys

- [ ] Add hreflang tags for SEO (AC: 9)
  - [ ] Add hreflang tags to all pages
  - [ ] Link to EN and FR versions
  - [ ] Example: `<link rel="alternate" hreflang="en" href="/en/pricing" />`
  - [ ] Use Next.js metadata API to add hreflang

- [ ] Localize date and number formatting (AC: 10)
  - [ ] Use Intl.DateTimeFormat for dates
  - [ ] Use Intl.NumberFormat for numbers
  - [ ] Configure next-intl formats

- [ ] Localize currency (AC: 11)
  - [ ] Display USD for EN locale
  - [ ] Display EUR for FR locale (if applicable)
  - [ ] Use Intl.NumberFormat for currency formatting

- [ ] Translate all marketing content (AC: 12)
  - [ ] Review all EN content
  - [ ] Translate to FR (professional translation recommended)
  - [ ] Review FR translations for accuracy
  - [ ] Update all i18n JSON files

- [ ] Testing and validation
  - [ ] Test language selector switches locale
  - [ ] Test URL routing for both EN and FR
  - [ ] Test cookie persistence
  - [ ] Test auto-detection on first visit
  - [ ] Verify all pages render correctly in both languages
  - [ ] Verify hreflang tags in page source
  - [ ] Test date and number formatting
  - [ ] Verify SEO (Google recognizes both language versions)

## Dev Notes

### Epic Context

This is Story 7.16 in Epic 7: Marketing Website & Landing Pages. This story ensures full multi-language support for English and French across all marketing pages.

**NOTE**: Epic 6 (Subscriptions & Billing) already implemented i18n. This story extends that implementation to all marketing pages and ensures comprehensive coverage.

### Tech Stack

- **Framework**: Next.js 16 (App Router)
- **React**: 19
- **TypeScript**: 5.x
- **i18n**: next-intl
- **Icons**: country-flag-icons or Lucide for flag icons

### Source Tree

- next-intl config: `next.config.js`, `middleware.ts`
- i18n messages: `locales/en.json`, `locales/fr.json`
- Language selector: `components/layout/language-selector.tsx`
- Navigation: `navigation.ts` (next-intl typed navigation)

### next-intl Configuration

**middleware.ts**:
```typescript
import createMiddleware from 'next-intl/middleware'

export default createMiddleware({
  locales: ['en', 'fr'],
  defaultLocale: 'en',
  localePrefix: 'always' // or 'as-needed'
})

export const config = {
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)']
}
```

**next.config.js**:
```javascript
const withNextIntl = require('next-intl/plugin')()

module.exports = withNextIntl({
  // other config
})
```

**i18n.ts** (configuration):
```typescript
import { getRequestConfig } from 'next-intl/server'

export default getRequestConfig(async ({ locale }) => ({
  messages: (await import(`./locales/${locale}.json`)).default
}))
```

### Language Selector Component

```typescript
'use client'

import { useRouter, usePathname } from '@/navigation'
import { useLocale } from 'next-intl'

export function LanguageSelector() {
  const router = useRouter()
  const pathname = usePathname()
  const locale = useLocale()

  const switchLocale = (newLocale: 'en' | 'fr') => {
    router.replace(pathname, { locale: newLocale })
  }

  return (
    <div className="flex gap-2">
      <button
        onClick={() => switchLocale('en')}
        className={locale === 'en' ? 'font-bold' : ''}
      >
        ðŸ‡¬ðŸ‡§ English
      </button>
      <button
        onClick={() => switchLocale('fr')}
        className={locale === 'fr' ? 'font-bold' : ''}
      >
        ðŸ‡«ðŸ‡· FranÃ§ais
      </button>
    </div>
  )
}
```

### Typed Navigation

```typescript
// navigation.ts
import { createSharedPathnamesNavigation } from 'next-intl/navigation'

export const locales = ['en', 'fr'] as const

export const { Link, redirect, usePathname, useRouter } =
  createSharedPathnamesNavigation({ locales })
```

### Using Translations in Components

```typescript
import { useTranslations } from 'next-intl'

export function HeroSection() {
  const t = useTranslations('Landing')

  return (
    <section>
      <h1>{t('hero_headline')}</h1>
      <p>{t('hero_subheadline')}</p>
    </section>
  )
}
```

### Localized Formatting

```typescript
import { useFormatter } from 'next-intl'

export function PriceDisplay({ amount }: { amount: number }) {
  const format = useFormatter()

  return (
    <p>
      {format.number(amount, {
        style: 'currency',
        currency: 'USD', // or 'EUR' based on locale
      })}
    </p>
  )
}
```

### hreflang Tags

```typescript
// app/[locale]/page.tsx
import { Metadata } from 'next'

export async function generateMetadata({ params }: { params: { locale: string } }): Promise<Metadata> {
  return {
    alternates: {
      canonical: `https://survey.fatihoune.com/${params.locale}`,
      languages: {
        'en': 'https://survey.fatihoune.com/en',
        'fr': 'https://survey.fatihoune.com/fr',
      },
    },
  }
}
```

### Sample i18n JSON Structure

**locales/en.json**:
```json
{
  "Landing": {
    "hero_headline": "Create Beautiful Surveys in Minutes",
    "hero_subheadline": "Collect feedback, analyze responses, and make data-driven decisions",
    "get_started_free": "Get Started Free"
  },
  "Features": {
    "hero_heading": "Powerful features for modern surveys"
  }
}
```

**locales/fr.json**:
```json
{
  "Landing": {
    "hero_headline": "CrÃ©ez de beaux sondages en quelques minutes",
    "hero_subheadline": "Collectez des commentaires, analysez les rÃ©ponses et prenez des dÃ©cisions basÃ©es sur les donnÃ©es",
    "get_started_free": "Commencer gratuitement"
  },
  "Features": {
    "hero_heading": "FonctionnalitÃ©s puissantes pour les sondages modernes"
  }
}
```

### Integration Points

- Extends existing i18n from Epic 6
- Language selector added to footer and navigation (Story 7.11)
- All marketing pages (Stories 7.1-7.15, 7.18)
- hreflang tags for SEO (Story 7.12)

### Testing

**Test File Location**: `__tests__/i18n/*.test.tsx`

**Testing Standards**:
- Test language selector switches locale
- Test URL routing (/en/* and /fr/*)
- Test cookie persistence
- Mock useRouter and usePathname from next-intl
- Test translations render correctly
- Test date/number formatting
- Verify hreflang tags in metadata

**Testing Frameworks**:
- Jest for test runner
- React Testing Library for component testing
- Mock next-intl hooks

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-06 | 1.0 | Initial story creation from Epic 7 | Sarah (PO Agent) |

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_To be filled by QA agent_
