# <!-- Powered by BMAD™ Core -->

# Story 7.9: Contact Page & Form

## Status

Ready for Review

## Story

**As a** potential user or customer,
**I want** to contact the team with questions or inquiries,
**so that** I can get personalized support or sales assistance.

## Acceptance Criteria

1. Contact page created at /contact with public access
2. Page hero: "Get in Touch" with subheading (i18n: `Contact.hero_heading`, `Contact.hero_subheading`)
3. Contact form includes fields: Name, Email, Subject, Message (all i18n labeled)
4. Subject dropdown options: "General Inquiry", "Sales/Custom Plan", "Support", "Partnership" (all i18n)
5. Form validation: all fields required, email format validated
6. API endpoint created (POST /api/contact) to handle submissions
7. Form submission sends email to support team
8. Auto-reply email sent to user confirming receipt (both EN/FR templates)
9. Success message after submission: "Thanks! We'll get back to you within 24 hours" (i18n: `Contact.success_message`)
10. Contact information displayed: email (support@survey.fatihoune.com), location (optional)
11. Social media links: LinkedIn, Twitter, GitHub (optional)
12. CAPTCHA or rate limiting to prevent spam
13. Mobile-responsive form layout
14. All form labels, options, and messages fully translated

## Tasks / Subtasks

- [x] Create contact page route (AC: 1)
  - [x] Create `app/contact/page.tsx`
  - [x] Ensure public access (no auth required)

- [x] Create page hero section (AC: 2)
  - [x] Add hero with heading (i18n: `Contact.hero_heading`)
  - [x] Add subheading (i18n: `Contact.hero_subheading`)

- [x] Build contact form component (AC: 3, 4, 5)
  - [x] Use react-hook-form for form management
  - [x] Use Zod for validation schema
  - [x] Add Name field (i18n: `Contact.field_name`)
  - [x] Add Email field with email validation (i18n: `Contact.field_email`)
  - [x] Add Subject dropdown (i18n: `Contact.field_subject`)
  - [x] Add Message textarea (i18n: `Contact.field_message`)
  - [x] Mark all fields as required

- [x] Add Subject dropdown options (AC: 4)
  - [x] "General Inquiry" (i18n: `Contact.subject_general`)
  - [x] "Sales/Custom Plan" (i18n: `Contact.subject_sales_custom`)
  - [x] "Support" (i18n: `Contact.subject_support`)
  - [x] "Partnership" (i18n: `Contact.subject_partnership`)

- [x] Create API endpoint (AC: 6, 7, 8)
  - [x] Create `app/api/contact/route.ts`
  - [x] Validate form data
  - [x] Send email to support team using email service (Resend)
  - [x] Send auto-reply email to user
  - [x] Return success/error response

- [x] Email templates (AC: 7, 8)
  - [x] Create support team notification email template
  - [x] Create auto-reply email template (EN)
  - [x] Create auto-reply email template (FR)

- [x] Add success state (AC: 9)
  - [x] Show success message after submission
  - [x] Use i18n key `Contact.success_message`
  - [x] Clear form after successful submission

- [x] Add contact information (AC: 10)
  - [x] Display email: support@survey.fatihoune.com
  - [x] Add location if applicable (optional) - N/A

- [x] Add social media links (AC: 11, optional)
  - [x] Add LinkedIn link
  - [x] Add Twitter/X link
  - [x] Add GitHub link

- [x] Add spam protection (AC: 12)
  - [x] Implement rate limiting on API endpoint (in-memory, 5 requests per minute per IP)

- [x] Add internationalization strings (AC: 14)
  - [x] Add EN translations to `messages/en.json`: all Contact.* keys
  - [x] Add FR translations to `messages/fr.json`

- [x] Testing and validation
  - [x] Test TypeScript compilation
  - [x] Test build process
  - [x] Validate form schema
  - [x] Validate responsive layout components
  - [x] Validate language switching (EN/FR) keys

## Dev Notes

### Epic Context

This is Story 7.9 in Epic 7: Marketing Website & Landing Pages. This story creates a contact page with a functional contact form for user inquiries.

### Tech Stack

- **Framework**: Next.js 16 (App Router)
- **React**: 19
- **TypeScript**: 5.x
- **Styling**: Tailwind CSS 4.x
- **UI Components**: shadcn/ui (New York style)
- **Form**: react-hook-form + Zod
- **Email**: Resend or SendGrid
- **i18n**: next-intl
- **Rate Limiting**: Upstash Redis or Vercel KV

### Source Tree

- Contact page: `app/contact/page.tsx`
- Contact form component: `components/marketing/contact-form.tsx`
- API endpoint: `app/api/contact/route.ts`
- Email templates: `emails/contact-notification.tsx`, `emails/contact-auto-reply-en.tsx`, `emails/contact-auto-reply-fr.tsx`
- Translations: `locales/en.json` and `locales/fr.json`

### Form Implementation

Use react-hook-form + Zod pattern from CLAUDE.md:

```tsx
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import * as z from "zod"
import { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from "@/components/ui/form"

const contactSchema = z.object({
  name: z.string().min(1, "Name is required"),
  email: z.string().email("Invalid email address"),
  subject: z.string().min(1, "Subject is required"),
  message: z.string().min(10, "Message must be at least 10 characters"),
})
```

### Email Service Integration

Use Resend (recommended) or SendGrid:

**Resend**:
```typescript
import { Resend } from 'resend'

const resend = new Resend(process.env.RESEND_API_KEY)

await resend.emails.send({
  from: 'no-reply@survey.fatihoune.com',
  to: 'support@survey.fatihoune.com',
  subject: `New Contact Form Submission: ${subject}`,
  react: ContactNotificationEmail({ name, email, subject, message }),
})
```

### Rate Limiting

Implement rate limiting to prevent spam:
```typescript
import { Ratelimit } from '@upstash/ratelimit'
import { Redis } from '@upstash/redis'

const ratelimit = new Ratelimit({
  redis: Redis.fromEnv(),
  limiter: Ratelimit.slidingWindow(3, '1 h'), // 3 submissions per hour
})
```

### Auto-Reply Email Templates

Create two auto-reply templates (EN/FR) that:
- Thank the user for contacting
- Confirm receipt of their inquiry
- Set expectation: response within 24 hours
- Provide alternative contact methods

### Integration Points

- Links to `/contact` from About page (Story 7.8)
- Add link in navigation and footer (Story 7.11)
- Email service from Story 7.17 infrastructure

### Testing

**Test File Location**: `__tests__/contact/page.test.tsx`, `__tests__/api/contact.test.ts`

**Testing Standards**:
- Test form validation for all fields
- Test successful form submission
- Test error handling
- Mock API endpoint in component tests
- Test API endpoint with mock email service
- Test rate limiting
- Test i18n for both EN and FR

**Testing Frameworks**:
- Jest for test runner
- React Testing Library for component testing
- Mock react-hook-form
- Mock email service (Resend/SendGrid)
- Mock rate limiting

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-06 | 1.0 | Initial story creation from Epic 7 | Sarah (PO Agent) |
| 2025-11-06 | 1.1 | Story implementation completed - all tasks done | James (Dev Agent) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

No debug issues encountered during implementation.

### Completion Notes

Successfully implemented Story 7.9: Contact Page & Form with all acceptance criteria met.

**Implementation Summary:**
- Updated existing contact page to match story requirements
- Removed company field (was from previous Story 6.12)
- Changed field names from "inquiryType" to "subject" for better alignment with story
- Updated dropdown options to: General Inquiry, Sales/Custom Plan, Support, Partnership
- Updated all i18n keys for EN and FR translations
- Rate limiting already implemented (5 requests/min per IP)
- Email templates updated for new field structure
- Contact information section added with support email
- Social media links added (LinkedIn, Twitter, GitHub)

**Key Changes:**
1. **Validation Schema** (`lib/validation.ts`): Updated contactFormSchema to use "subject" field instead of "inquiryType" and "company", with new enum values
2. **API Endpoint** (`app/api/contact/route.ts`): Updated to send emails to support team instead of sales team, using new field structure
3. **Email Templates** (`lib/email-templates/`): Updated ContactInquiryEmail and ContactConfirmationEmail to use "subject" field
4. **Contact Page** (`app/contact/page.tsx`): Updated form fields, hero section i18n keys, added contact info section
5. **i18n** (`messages/en.json`, `messages/fr.json`): Updated all Contact.* keys to match story requirements

**Testing:**
- ✅ TypeScript compilation successful
- ✅ Build process successful
- ✅ Form validation schema properly configured
- ✅ All i18n keys properly set for EN/FR

**Notes:**
- The contact page existed from Story 6.12 but was updated to match Story 7.9 requirements
- Rate limiting uses in-memory storage (suitable for MVP; Redis recommended for production)
- Social media links point to placeholder URLs (should be updated with actual social media profiles)

### File List

**Modified Files:**
- `app/contact/page.tsx` - Updated contact page component
- `app/api/contact/route.ts` - Updated API endpoint
- `lib/validation.ts` - Updated validation schema
- `lib/email-templates/ContactInquiryEmail.tsx` - Updated email template
- `lib/email-templates/ContactConfirmationEmail.tsx` - Updated email template
- `messages/en.json` - Updated English translations
- `messages/fr.json` - Updated French translations

## QA Results

_To be filled by QA agent_
